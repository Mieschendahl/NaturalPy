# NaturalPy

*NaturalPy* is a Python library that lets you program using **natural language** in python.

```python
# examples/example_hello_world.py
@implement
def hello_world() -> None:
    """Prints "Hello World!" in german."""
    return Config(model=model)

hello_world()  # prints "Hello Welt!"
```

*NaturalPy* builds up on the LLM prompting library [*PromptPy*](https://github.com/Mieschendahl/PromptPy).

## Features

### Modular

*PromptPy* provides the abstract `Model` class as an interface to your custom LLM implementation.
See `examples/gpt.py` for an example implementation for *ChatGPT*.

### Cheap & Fast

The `Model` class will cache LLM responses whenever possible, which saves the time and money needed for regenerating implementations from scratch.

### Easy-To-Use

- You can add the *implement* decorator to a function signature to implement it automatically.
The function should return a *Config* object which defines the implementation configuration.

    ```python
    # examples/example_mean.py
    @implement
    def mean(ls: list[float]) -> float:
        """Returns the mean of a list of floats."""
        return Config(model=model)

    print(mean([1,2,3]))  # prints 2.0
    ```

- You can provide *helper functions* which the implementation can use.

    ```python
    # examples/example_variance_helper.py
    @implement
    def variance(ls: list[float]) -> float:
        """Returns the variance of a function."""
        return Config(model=model, functions=[mean])

    print(variance([1,2,3,4]))  # prints 1.25
    ```

- You can specify a sketch of how the implementation of the function should look like.

    ```python
    # examples/example_variance_sketch.py
    @implement
    def variance(ls: list[float]) -> float:
        sketch = """
        # TODO: if ls is empty then return 0

        m = mean(ls)
        new_ls = [(e - m)**2 for e in ls]

        # TODO: return mean of new_ls
        """
        return Config(model=model, functions=[mean], sketch=sketch)

    print(variance([1,2,3,4]))  # prints 1.25
    ```

- You can define tests, using the *Tester* class, that the function implementation has to pass.

    ```python
    # examples/example_variance_tester.py
    @implement
    def variance(ls: list[float]) -> float:
        """Returns the variance of a function."""
        tester = Tester()\
                .check([], equals=0)\
                .check([1], equals=0)\
                .check([1,2], equals=0.25)\
                .check([1,2,3], equals=2/3, tolerance=1e-9)
        return Config(model=model, functions=[mean], tester=tester)

    print(variance([1,2,3,4]))  # prints 1.25
    ```

### Debugabble

Create readable implementation logs for debugging.

```python
# examples/example_halting_problem.py
with open("logs.txt", "w") as log_file:
    @implement  # will raise an ImplementationError!
    def halting(code: str) -> bool:  # impossible to implement
        """Determins if a given python code defines a function
        that will always return for any input at some point in time."""  
        return Config(model=model, log_file=log_file, id="Halting")
```
Contents of `logs.txt`:
```
PROMPTER "Halting"

DEVELOPER:
 | You are a python expert who should help the user implement a python function.
 | Never use libraries outside of python's standard library!

USER:
 | Please implement the function "halting" for me:
 | Signature: halting(code: str) -> bool
 | Specification: Determins if a given python code defines a function
 | that will always return for any input at some point in time.

USER:
 | Think step by step about how to implement the function.
 | Also consider if the function can not be implemented because of an impossible specification.

...

ASSISTANT:
 | impossible:
 | The task of determining whether a given Python code defines a function that will always return
 | for any input is fundamentally impossible due to the Halting Problem. There is no general
 | algorithm that can determine if any arbitrary program will finish running or continue indefinitely.
 | Therefore, the function cannot be implemented as specified.

```

## Setup

⚠️ **Warning**: *NaturalPy* executes code generated by LLMs, that means **it should only be executed in secure environments**!

1. Install *NaturalPy*.

    ```bash
    pip install --upgrade git+https://github.com/Mieschendahl/NaturalPy.git
    ```

2. Provide a `Model` class implementation (e.g. `examples/gpt.py`).

The `examples` directory contains some examples.